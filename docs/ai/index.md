# CAF GPT â€“ Cloudflare Serverless Edition

> ðŸ¤– AI Agent Navigation Guide â€” Project index for humans and LLM coding agents

Use this page to jump to focused docs. Each doc follows an agent-friendly structure (Mission, Context, Contracts, Constraints, Steps, Edge cases, Validation, Donâ€™ts, Links).

## Quick Links

- Setup: ./core.md
- Testing: ./testing.md
- Core Handbook (AI, DB, Workers, Conventions): ./core.md
- Modules handbook: ./modules.md
- Routes handbook: ./routes.md
- PaceNote module: ./module.paceNote.md
- PolicyFoo module: ./module.policyFoo.md (with ./module.policyFoo.doadFoo.md and ./module.policyFoo.leaveFoo.md)

## Development â€” Quick Commands

```bash
npm run lint          # Prettier + lint
npm run dev           # Build once, start wrangler dev with remote resources
npm run build         # Production build
npm run preview       # Build and preview locally
```

## Overview & Project Structure

Domain Modules:

- PaceNote: Generate performance feedback notes based on observations and rank competencies
- PolicyFoo: Answer policy questions with authoritative citations from CAF documents

Architecture Principles:

- Co-located components and docs
- Domain services (business logic by functional domain)
- Type-safe end-to-end TypeScript
- Server-first rendering for security/perf
- Prompts stored as static files

Project Structure

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ db/
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ paceNote/
â”‚       â””â”€â”€ policyFoo/
â””â”€â”€ routes/
    â”œâ”€â”€ pacenote/
    â””â”€â”€ policy/
```

See: ./modules.md and ./routes.md

## Modules (jump-start)

### PaceNote Service

- Status: âœ… Production Ready
- Route: /pacenote
- Domain: Performance Feedback
- Docs: ./module.paceNote.md
- Route Docs: ./routes.md#pacenote-route

### PolicyFoo Service

- Status: âœ… Production Ready
- Route: /policy
- Domain: Policy Q&A
- Docs: ./module.policyFoo.md
- Handler Docs: ./module.policyFoo.doadFoo.md, ./module.policyFoo.leaveFoo.md
- Route Docs: ./routes.md#policy-route

## Architecture

Modern Serverless Stack:

- Frontend: SvelteKit + TypeScript
- Backend: Cloudflare Workers
- Database: Postgres via Cloudflare Hyperdrive (node-postgres)
- AI Integration: Cloudflare AI Gateway with OpenRouter
- Styling: Tailwind CSS v4
- Testing: Vitest (multi env)

Key features:

- Security-first SSR
- Type-safe DB access patterns
- AI Gateway monitoring
- Comprehensive testing

## Configuration (bindings overview)

Defined in wrangler.jsonc:

- AI Gateway (OpenRouter provider)
- Hyperdrive (Postgres pooling)
- Env vars for model selection and secrets

Details: ./core.md

## Common Error Patterns

Environment

- Missing OPENROUTER_TOKEN â†’ use wrangler secret put OPENROUTER_TOKEN
- Hyperdrive configured as binding, not direct DB string
- AI Gateway base URL/token mismatches

Integration

- Import errors â†’ check index.ts co-located exports
- Type errors â†’ verify module types.ts are exported
- Shared service imports â†’ $lib/core/ai-gateway.service

Database

- Pooling via Hyperdrive
- Schema edits â†’ update $lib/core/db/types.ts and services
- Query perf â†’ follow $lib/core/db/service.ts patterns

## ðŸ“Ž AI Agent Guidelines (short)

File organization

- Services per domain; shared infra in $lib/core
- One types.ts per module
- Routes co-locate UI + server logic

Common tasks

- New module â†’ copy structure from PaceNote/PolicyFoo
- New route â†’ standard SvelteKit structure
- DB ops â†’ core/db service patterns
- LLM â†’ AI Gateway service

Testing approach: see ./testing.md
